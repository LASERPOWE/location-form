<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Auto Address Form</title>
  <style>
    body {
      font-family: Arial;
      padding: 20px;
    }
    input, button {
      padding: 10px;
      width: 100%;
      margin-top: 10px;
    }
    #status {
      color: green;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h2>📍 Auto Address from Location</h2>
  <form id="locationForm">
    <label for="address">Current Address:</label>
    <input type="text" id="address" name="address" readonly required>
    <button type="submit">Submit</button>
    <p id="status"></p>
  </form>

  <script>
    // 1. Get Location on Load
    window.onload = function () {
      if ("geolocation" in navigator) {
        navigator.geolocation.getCurrentPosition(
          function (position) {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;

            fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`)
              .then(res => res.json())
              .then(data => {
                document.getElementById("address").value = data.display_name;
              })
              .catch(() => {
                document.getElementById("address").value = "Could not fetch address.";
              });
          },
          function (error) {
            document.getElementById("address").value = "Location permission denied.";
          }
        );
      } else {
        document.getElementById("address").value = "Geolocation not supported.";
      }
    };

    // 2. Submit Form
    document.getElementById("locationForm").addEventListener("submit", function (e) {
      e.preventDefault();

      const address = document.getElementById("address").value;

      fetch("https://script.google.com/macros/s/AKfycbwo_9o4UxgcQfFxQtEHPb9351an-SoYQQ3d2CfeWh4v0Qr-BHHXzjtp9ccEGULNC_AfNw/exec", {
        method: "POST",
        mode: "no-cors", // 👈 Add this line!
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ address })
      })
      .then(() => {
        document.getElementById("status").textContent = "✅ Submitted successfully!";
      })
      .catch((err) => {
        document.getElementById("status").textContent = "❌ Submission failed.";
        console.error("Submission error:", err);
      });
    });
  </script>
</body>
</html>
